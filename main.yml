---
- name: create inventory
  hosts: jumpbox
  roles:
    - role: osp_facts

- name: base config 
  hosts: "{{ item }}"
  roles:
    - role: configuration
  with_items:
    [frontends, apps, appdbs]

- name: deploy haproxy
  hosts: frontends
  roles:
    - role: deploy-haproxy

- name: deploy tomcat
  hosts: apps
  roles:
    - role: deploy-tomcat

- name: deploy postgres
  become: true
  hosts: appdbs
  roles:
    - { role: geerlingguy.postgresql }

- name: deploy apache
  hosts: apps
  roles:
  - role: deploy-apache
